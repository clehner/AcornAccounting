{% extends "site.html" %}

{% load accounting_filters %}
{% load accounting_tags %}

{% block title %}General Ledger{% endblock %}

{% block content %}

<div class="page-header">
  <h1>General Ledger <small>{{ start_date }} - {{ stop_date }}</small></h1>
</div>

<!-- Date Range Form -->
{% date_range_form form %}


<!-- Entry/Transaction Table -->
<table summary="General Ledger" id="accounts_chart" class="table table-hover table-condensed">
  <thead>
    <tr>
      <th>Number</th>
      <th>Date</th>
      <th colspan="4" class="">Memo</th>
    </tr>
  </thead>
  {% for entry in journal_entries %}
    <tbody>
      <tr class="header clickable">
        <td><a href="{{ entry.get_absolute_url }}">{{ entry.get_number }}</a></td>
        <td>{{ entry.date|date:"m/d/Y" }}</td>
        <td colspan="4" class="">{{ entry.memo|capwords }}</td>
      </tr>
      <tr>
        <td></td>
        <td>Account</td>
        <td>Detail</td>
        <td class="text-right">Debit</td>
        <td class="text-right">Credit</td>
        <td class="text-right">Event</td>
      </tr>
      {% for transaction in entry.transaction_set.all.select_related %}
        <tr class="{% cycle 'main' 'alt' %} clickable">
          <td></td>
          <td><a href="{{ transaction.account.get_absolute_url }}">{{ transaction.account }}</a></td>
          <td>{{ transaction.detail }}</td>
          {% if transaction.balance_delta < 0 %}
            <td class="text-right">{{ transaction.balance_delta|currency }}</td>
            <td class="text-right"></td>
          {% else %}
            <td class="text-right"></td>
            <td class="text-right">{{ transaction.balance_delta|currency }}</td>
          {% endif %}
          <td class="text-right">{% if transaction.event %}<a href="{{ transaction.event.get_absolute_url }}">{{ transaction.event }}</a>{% endif %}</td>
        </tr>
      {% endfor %}
      <tr><td colspan="6">&nbsp;</td></tr>
    </tbody>
  {% endfor %}
</table>

<br /><br />

{% endblock %}


{% block javascript %}
<script type="text/javascript" src="{{ STATIC_URL }}js/parsley.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/parsley.extend.js"></script>
<script type="text/javascript">
    $(document).ready( function () {
        $('#date_range_form').parsley({
            successClass: 'has-success',
            errorClass: 'has-error',
            errors: {
                classHandler: function (el) {
                    return $(el).closest('.form-group');
                },
                errorsWrapper: '<ul></ul>',
                errorElem: '<li></li>'
            }
        });
    });
</script>
{% endblock %}
